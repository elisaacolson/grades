---
title: "COLSON"
author: "Elisa Colson"
format: html
---

```{r}
here::i_am("grades.Rproj")
library(here)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(lubridate)
```

### Question 1

```{r}
cours <- read_csv(here("DATA/courses.csv"))
```

### Question 2

```{r}
cours %>% 
  arrange(course) %>% 
  rename(
    Course = course,
    `Course ID` = course_id,
    Trimester = trimester,
    `Number of Exams` = nb_grades
  ) %>% 
  kable() 
```

### Question 3

```{r}
student <- read_csv(here("DATA/students.csv"))

```

```{r}
spec(student)
```

```{r}
col_types = cols(
    id = col_integer(),
    group = col_factor(),
    birth_date = col_date(format = "%Y-%m-%d"),
    sex = col_factor()
  )

```

The `birth_date` column of the students data frame is of class `r class(student$birth_date)`.

### Question 4

```{r}
grades <- read_csv(here("DATA/grades.csv"))
grades <- read_delim(
  here("DATA/grades.csv"),
  delim = ";",        # Séparateur ;
  na = "*",           # NA représenté par *
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

```

## Student population analysis

### Question 5

```{r}
student %>% 
  count(group) %>% 
  ggplot(aes(x = group, y = n)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  )
```

### Question 6

```{r}
ggplot(student, aes(x = group, fill = sex)) +
  geom_bar() +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Number of Students",
    fill = "Gender"
  )
```

### Question 7

```{r}

student <- student %>% 
  mutate(
    age = round(time_length(today() - birth_date, unit = "year"))
  )

# Histogramme de l'âge
ggplot(student, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "steelblue", color = "white") +
  labs(
    title = "Distribution of Student Ages",
    x = "Age (years)",
    y = "Number of Students"
  ) +
  theme_minimal()
```
```{r}
colnames(student)

```

### Question 8

```{r}
# Calculer l'âge médian par groupe
median_age_by_group <- student %>% 
  mutate(age = round(time_length(today() - birth_date, unit = "year"))) %>% 
  group_by(group) %>% 
  summarise(median_age = as.integer(median(age))) %>% 
  rename(Group = group, `Median Age` = median_age)

# Afficher le tableau
median_age_by_group %>% 
  kable()
```

### Question 9

```{r}
# Trouver l'étudiant le plus âgé par groupe
oldest_by_group <- student %>% 
  mutate(age = round(time_length(today() - birth_date, unit = "year"))) %>% 
  group_by(group) %>% 
  slice_max(age, n = 1) %>%  # Garde le plus âgé de chaque groupe
  ungroup() %>% 
  select(id, sex, age, group) %>% 
  arrange(desc(age)) %>%  # Trie par âge décroissant
  rename(ID = id, Sex = sex, Age = age, Group = group)

# Afficher le tableau
oldest_by_group %>% 
  kable()
```

## Simple grade analysis

### Question 10

```{r}
nb_grades <- grades %>% 
  filter(!is.na(grade)) %>% 
  nrow()
```

The data set contains `r nb_grades` grades.

### Question 11

```{r}
grades %>% 
  left_join(student, by = "id") %>% 
  left_join(cours, by = "course_id") %>% 
  filter(course == "Ayurveda and Traditional Medicine") %>% 
  group_by(group) %>% 
  summarise(avg_grade = mean(grade, na.rm = TRUE)) %>% 
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Average Grade in Ayurveda and Traditional Medicine by Group",
    x = "Group",
    y = "Average Grade"
  ) +
  theme_minimal()
```
### Question 12

```{r}
grades %>% 
  left_join(cours, by = "course_id") %>% 
  filter(!is.na(grade)) %>%  # Enlève les notes manquantes
  ggplot(aes(x = as.factor(trimester), y = grade, fill = as.factor(trimester))) +
  geom_boxplot() +
  labs(
    title = "Distribution of Grades by Trimester",
    x = "Trimester",
    y = "Grade",
    fill = "Trimester"
  ) 
```
## Attendance Analysis
### Question 13

```{r}
# Nombre de notes par étudiant
nb_grades_per_student <-grades %>% 
  filter(!is.na(grade)) %>% 
  group_by(id) %>% 
  summarise(nb_grades = n()) %>% 
  left_join(student %>% select(id, group, sex), by = "id")
```
 
```{r}
# Afficher un extrait
nb_grades_per_student %>% 
  slice_sample(n = 10) %>% 
  kable()

# Statistiques
nb_grades_per_student %>% 
  summarise(
    Minimum = min(nb_grades),
    Maximum = max(nb_grades),
    Average = round(mean(nb_grades), 1),
    Median = median(nb_grades)
  ) %>% 
  kable()
```

### Question 14


```{r}
nb_grades_per_student %>% 
  ggplot(aes(x = sex, y = nb_grades, fill = sex)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.2, alpha = 0.5) +
  scale_fill_manual(values = c("F" = "#E91E63", "M" = "#2196F3")) +
  labs(
    title = "Distribution of Number of Grades by Gender",
    x = "Gender",
    y = "Number of Grades"
  )
```
### Question 15

```{r}
# Créer le dataframe
music_dance_grades <- grades %>% 
  left_join(cours, by = "course_id") %>% 
  filter(course == "Music and Dance") %>%  # Filtre le cours
  filter(!is.na(grade)) %>%  # Seulement les notes non manquantes
  group_by(id) %>% 
  summarise(nb_grades_music_dance = n()) %>% 
  left_join(student %>% select(id, group), by = "id")

# Afficher un extrait
music_dance_grades %>% 
  slice_sample(n = 10) %>% 
  kable()
```
### Question 16

```{r}
# Distribution du nombre de notes
distribution_music_dance <- music_dance_grades %>% 
  count(nb_grades_music_dance, name = "nb_students")

# Afficher le tableau
distribution_music_dance %>% 
  kable()

# Graphique
distribution_music_dance %>% 
  ggplot(aes(x = nb_grades_music_dance, y = nb_students)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = nb_students), vjust = -0.5) +
  labs(
    title = "Distribution of Number of Grades in Music and Dance",
    x = "Number of Grades",
    y = "Number of Students"
  ) +
  theme_minimal()
```

