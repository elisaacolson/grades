---
title: "COLSON"
author: "Elisa Colson"
format: html
---

```{r}
here::i_am("grades.Rproj")
library(here)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(lubridate)
```

### Question 1

```{r}
cours <- read_csv(here("DATA/courses.csv"))
```

### Question 2

```{r}
cours %>% 
  arrange(course) %>% 
  rename(
    Course = course,
    `Course ID` = course_id,
    Trimester = trimester,
    `Number of Exams` = nb_grades
  ) %>% 
  kable() 
```

### Question 3

```{r}
student <- read_csv(here("DATA/students.csv"))

```

```{r}
spec(student)
```

```{r}
col_types = cols(
    id = col_integer(),
    group = col_factor(),
    birth_date = col_date(format = "%Y-%m-%d"),
    sex = col_factor()
  )

```

The `birth_date` column of the students data frame is of class `r class(student$birth_date)`.

### Question 4

```{r}
grades <- read_csv(here("DATA/grades.csv"))
grades <- read_delim(
  here("DATA/grades.csv"),
  delim = ";",        # Séparateur ;
  na = "*",           # NA représenté par *
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

```

## Student population analysis

### Question 5

```{r}
student %>% 
  count(group) %>% 
  ggplot(aes(x = group, y = n)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  )
```

### Question 6

```{r}
ggplot(student, aes(x = group, fill = sex)) +
  geom_bar() +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Number of Students",
    fill = "Gender"
  )
```

### Question 7

```{r}

student <- student %>% 
  mutate(
    age = round(time_length(today() - birth_date, unit = "year"))
  )

# Histogramme de l'âge
ggplot(student, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "steelblue", color = "white") +
  labs(
    title = "Distribution of Student Ages",
    x = "Age (years)",
    y = "Number of Students"
  ) +
  theme_minimal()
```
```{r}
colnames(student)

```

### Question 8

```{r}
# Calculer l'âge médian par groupe
median_age_by_group <- student %>% 
  mutate(age = round(time_length(today() - birth_date, unit = "year"))) %>% 
  group_by(group) %>% 
  summarise(median_age = as.integer(median(age))) %>% 
  rename(Group = group, `Median Age` = median_age)

# Afficher le tableau
median_age_by_group %>% 
  kable()
```

### Question 9

```{r}
# Trouver l'étudiant le plus âgé par groupe
oldest_by_group <- student %>% 
  mutate(age = round(time_length(today() - birth_date, unit = "year"))) %>% 
  group_by(group) %>% 
  slice_max(age, n = 1) %>%  # Garde le plus âgé de chaque groupe
  ungroup() %>% 
  select(id, sex, age, group) %>% 
  arrange(desc(age)) %>%  # Trie par âge décroissant
  rename(ID = id, Sex = sex, Age = age, Group = group)

# Afficher le tableau
oldest_by_group %>% 
  kable()
```

## Simple grade analysis

### Question 10

```{r}
nb_grades <- grades %>% 
  filter(!is.na(grade)) %>% 
  nrow()
```

The data set contains `r nb_grades` grades.

### Question 11

```{r}
grades %>% 
  left_join(student, by = "id") %>% 
  left_join(cours, by = "course_id") %>% 
  filter(course == "Ayurveda and Traditional Medicine") %>% 
  group_by(group) %>% 
  summarise(avg_grade = mean(grade, na.rm = TRUE)) %>% 
  ggplot(aes(x = group, y = avg_grade)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Average Grade in Ayurveda and Traditional Medicine by Group",
    x = "Group",
    y = "Average Grade"
  ) +
  theme_minimal()
```
### Question 12

```{r}
grades %>% 
  left_join(cours, by = "course_id") %>% 
  filter(!is.na(grade)) %>%  # Enlève les notes manquantes
  ggplot(aes(x = as.factor(trimester), y = grade, fill = as.factor(trimester))) +
  geom_boxplot() +
  labs(
    title = "Distribution of Grades by Trimester",
    x = "Trimester",
    y = "Grade",
    fill = "Trimester"
  ) 
```
## Attendance Analysis
### Question 13

```{r}
# Nombre de notes par étudiant
nb_grades_per_student <-grades %>% 
  filter(!is.na(grade)) %>% 
  group_by(id) %>% 
  summarise(nb_grades = n()) %>% 
  left_join(student %>% select(id, group, sex), by = "id")
```
 
```{r}
# Afficher un extrait
nb_grades_per_student %>% 
  slice_sample(n = 10) %>% 
  kable()

# Statistiques
nb_grades_per_student %>% 
  summarise(
    Minimum = min(nb_grades),
    Maximum = max(nb_grades),
    Average = round(mean(nb_grades), 1),
    Median = median(nb_grades)
  ) %>% 
  kable()
```

### Question 14


```{r}
nb_grades_per_student %>% 
  ggplot(aes(x = sex, y = nb_grades, fill = sex)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.2, alpha = 0.5) +
  scale_fill_manual(values = c("F" = "#E91E63", "M" = "#2196F3")) +
  labs(
    title = "Distribution of Number of Grades by Gender",
    x = "Gender",
    y = "Number of Grades"
  )
```
### Question 15

```{r}
# Créer le dataframe
music_dance_grades <- grades %>% 
  left_join(cours, by = "course_id") %>% 
  filter(course == "Music and Dance") %>%  # Filtre le cours
  filter(!is.na(grade)) %>%  # Seulement les notes non manquantes
  group_by(id) %>% 
  summarise(nb_grades_music_dance = n()) %>% 
  left_join(student %>% select(id, group), by = "id")

# Afficher un extrait
music_dance_grades %>% 
  slice_sample(n = 10) %>% 
  kable()
```
### Question 16

```{r}
# Distribution du nombre de notes
distribution_music_dance <- music_dance_grades %>% 
  count(nb_grades_music_dance, name = "nb_students")

# Afficher le tableau
distribution_music_dance %>% 
  kable()

# Graphique
distribution_music_dance %>% 
  ggplot(aes(x = nb_grades_music_dance, y = nb_students)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = nb_students), vjust = -0.5) +
  labs(
    title = "Distribution of Number of Grades in Music and Dance",
    x = "Number of Grades",
    y = "Number of Students"
  ) +
  theme_minimal()
```

### Question 17

```{r}
music_dance_grades %>% 
  ggplot(aes(x = factor(group), y = nb_grades_music_dance)) +
  geom_boxplot(fill = "lightblue") +
  labs(
    title = "Number of Grades in Music and Dance by Group",
    x = "Group",
    y = "Number of Grades"
  ) +
  theme_minimal()
```

### Question 18 

```{r}
music_dance_grades <- grades %>% 
  left_join(cours, by = "course_id") %>% 
  filter(course == "Music and Dance") %>%  
  filter(!is.na(grade)) %>%  
  group_by(id) %>% 
  summarise(nb_grades_music_dance = n()) %>% 
  left_join(student %>% select(id, group, sex), by = "id")

ggplot(music_dance_grades, aes(x = factor(group), 
                               y = nb_grades_music_dance)) +
  geom_boxplot(fill = "lightblue") +
  facet_wrap(~ sex) +
  labs(
    title = "Number of Grades in Music & Dance by Group, Separated by Sex",
    x = "Group",
    y = "Number of Grades"
  ) +
  theme_minimal()
```

## Grade Analysis

### question 19

```{r}
# Calculer la moyenne des notes par étudiant et par cours
grades_wide <- grades %>%
  filter(!is.na(grade)) %>%                    # Ignorer les notes manquantes
  group_by(id, course_id) %>%                  # Grouper par étudiant et par cours
  summarise(avg_grade = mean(grade), .groups = "drop") %>%  # Calculer la moyenne et supprimer le regroupement
  left_join(cours %>% select(course_id, course), by = "course_id") %>%  # Ajouter le nom du cours
  left_join(student %>% select(id, group), by = "id") %>%  # Ajouter le groupe de l’étudiant
  mutate(avg_grade = round(avg_grade, 2)) %>%   # Arrondir la moyenne à 2 décimales
  select(id, group, course, avg_grade) %>%
  pivot_wider(                                 # Transformer en format large : 1 colonne par cours
    names_from = course,
    values_from = avg_grade
  )

# Afficher un petit extrait pour Quarto
grades_wide %>%
  select(id, group, `Architecture and Sculpture`, `Astrology and Astrology`) %>%  # Sélectionner id, group et 2 cours pour l’extrait
  slice_sample(n = 5) %>%  # Afficher 5 lignes aléatoires
  kable()                  # Formater le tableau joliment pour Quarto
```
### Question 20

```{r}
grades_wide %>%
  ggplot(aes(
    x = `Martial Arts and Self-Defense`,
    y = `Music and Dance`
  )) +
  geom_jitter(width = 0.2, height = 0.2, color = "steelblue", alpha = 0.7, size = 3) +
  geom_smooth(method = "lm", color = "darkred", linetype = "dashed") +
  labs(
    title = "Average Grades: Music and Dance vs Martial Arts and Self-Defense",
    x = "Average Grade in Martial Arts and Self-Defense",
    y = "Average Grade in Music and Dance"
  ) +
  theme_minimal(base_size = 14) +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"))
```
The graph shows us that there is a slightly correlation between these two grade(red line).
### Question 21

```{r}
correlation_by_group <- grades_wide %>%
  select(group, `History and Civilization of India`, `Vedic Philosophy and Spirituality`) %>%
  group_by(group) %>%                                # Grouper par groupe
  summarise(
    correlation = cor(
      `History and Civilization of India`,
      `Vedic Philosophy and Spirituality`,
      use = "complete.obs"  # ignore les NA
    ),
    .groups = "drop"
  )

# Afficher le résultat
correlation_by_group %>% 
  kable()
```
We observ that for every groups (except 11) the correlation is negative between these two classes. Some groups more than others with -0.55 of correlation for the group 12 compared to the group 19 which has -0.05 of correlation.  Maybe because they both ask for a lot of works
### Question 22 

```{r}
# 1. Calculer la corrélation par groupe
correlation_by_group <- grades_wide %>%
  select(group, `History and Civilization of India`, `Vedic Philosophy and Spirituality`) %>%
  group_by(group) %>%
  summarise(
    correlation = cor(
      `History and Civilization of India`,
      `Vedic Philosophy and Spirituality`,
      use = "complete.obs"
    ),
    .groups = "drop"
  )

# 2. Identifier le groupe avec corrélation maximale en valeur absolue
target_group <- correlation_by_group %>%
  slice_max(abs(correlation), n = 1) %>%
  pull(group)

# 3. Sélectionner les étudiants de ce groupe
students_target_group <- grades_wide %>%
  filter(group == target_group)

# 4. Graphique scatter plot
ggplot(students_target_group, aes(
  x = `Vedic Philosophy and Spirituality`,
  y = `History and Civilization of India`
)) +
  geom_point(color = "steelblue", size = 3, alpha = 0.7) +  # points lisibles
  geom_smooth(method = "lm", color = "darkred", linetype = "dashed", se = FALSE) + # ligne de tendance
  labs(
    title = paste0("Group ", target_group, ": History vs Vedic Philosophy"),
    x = "Average Grade in Vedic Philosophy and Spirituality",
    y = "Average Grade in History and Civilization of India"
  ) 
```
There is a clear correlation between these two variables, as we selected the extreme values. This confirms that they are strongly negatively correlated.
### Question 23

```{r}
# 1. Calculer la note finale
final_grades <- grades_wide %>%
  rowwise() %>%  # permet de faire des calculs par ligne
  mutate(final_grade = mean(c_across(-c(id, group)), na.rm = TRUE)) %>%  # moyenne des colonnes de cours
  ungroup() %>%
  left_join(student %>% select(id, sex), by = "id") %>%  # ajouter le sexe
  select(id, group, sex, final_grade) %>%  # garder uniquement les colonnes demandées
  arrange(desc(final_grade))  # trier par note finale décroissante

# 2. Afficher les 5 meilleurs étudiants pour Quarto
final_grades %>%
  slice_head(n = 5) %>%
  kable()
```
The group 9 has the 4 first of the prom. We can assume that this group is better than the others.
### Question 24


```{r}
ggplot(final_grades, aes(x = factor(group), y = final_grade)) +
  geom_boxplot(fill = "lightblue") +
  geom_jitter(width = 0.2, alpha = 0.6, color = "steelblue") + # points pour voir chaque étudiant
  labs(
    title = "Final Grades by Group",
    x = "Group",
    y = "Final Grade"
  ) +
  theme_minimal(base_size = 14)

```
Initially, I chose to analyze the data using a table showing the mean, median, and standard deviation. However, I believe that this graph illustrates the differences between the groups much more clearly. Indeed, as in the previous question, we can see that Group 9, for instance, stands out significantly compared to the others.

### Question 25 

```{r}
ggplot(final_grades, aes(x = factor(group), y = final_grade, fill = sex)) +
  geom_boxplot(width = 0.6, position = position_dodge(0.9)) + 
  geom_jitter(aes(color = sex), size = 2, alpha = 0.5, 
              position = position_jitterdodge(jitter.width = 0.25, dodge.width = 0.9)) +
  labs(
    title = "Final Grades by Group and Sex",
    x = "Group",
    y = "Final Grade",
    fill = "Sex",
    color = "Sex"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # texte des groupes incliné
    legend.position = "top"
  )
```
We cannot observe a clear difference between males and females. However, if we look more closely, for instance in Group 19, the girls have, on average, higher grades, although the top students in the class are male.
